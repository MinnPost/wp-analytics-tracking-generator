;(function($) {
"use strict";

function wpAnalyticsCheckAnalyticsVersion() {
  let version = '';

  if ('undefined' !== typeof analytics_tracking_settings && 'undefined' !== typeof analytics_tracking_settings.analytics_type) {
    if ('gtagjs' === analytics_tracking_settings.analytics_type && 'function' === typeof gtag) {
      version = 'gtag';
    } else if ('analyticsjs' === analytics_tracking_settings.analytics_type && 'function' === typeof ga) {
      version = 'ga';
    }
  }

  return version;
}
/*
 * call hooks from other plugins or themes
 *
 */


if (typeof wp !== 'undefined') {
  wp.hooks.addAction('wpAnalyticsTrackingGeneratorEvent', 'wpAnalyticsTrackingGenerator', wpAnalyticsTrackingEvent, 10);
  wp.hooks.addAction('wpAnalyticsTrackingGeneratorEcommerceAction', 'wpAnalyticsTrackingGenerator', wpAnalyticsTrackingEcommerceAction, 10);
}
/*
 * Create a Google Analytics event
 * category: Event Category
 * label: Event Label
 * action: Event Action
 * value: optional
 */


function wpAnalyticsTrackingEvent(type, category, action, label, value, non_interaction) {
  const version = wpAnalyticsCheckAnalyticsVersion();

  if ('gtag' === version) {
    // Sends the event to the Google Analytics property with
    // tracking ID GA_MEASUREMENT_ID set by the config command in
    // the global tracking snippet.
    // example: gtag('event', 'play', { 'event_category': 'Videos', 'event_label': 'Fall Campaign' });
    const params = {
      event_category: category,
      event_label: label
    };

    if ('undefined' !== typeof value) {
      params.value = value;
    }

    if ('undefined' !== typeof non_interaction) {
      params.non_interaction = non_interaction;
    }

    gtag(type, action, params);
  } else if ('ga' === version) {
    // Uses the default tracker to send the event to the
    // Google Analytics property with tracking ID GA_MEASUREMENT_ID.
    // example: ga('send', 'event', 'Videos', 'play', 'Fall Campaign');
    // noninteraction seems to have been working like this in analytics.js.
    if (non_interaction === 1) {
      value = {
        nonInteraction: 1
      };
    }

    if ('undefined' === typeof value) {
      ga('send', type, category, action, label);
    } else {
      ga('send', type, category, action, label, value);
    }
  }
}
/*
 * Create a Google Analytics Ecommerce action
 *
 */


function wpAnalyticsTrackingEcommerceAction(type, action, product, step) {
  const version = wpAnalyticsCheckAnalyticsVersion();

  if ('gtag' === version) {
    gtag(type, action, {
      items: [product]
    });
  } else if ('ga' === version) {
    ga('require', 'ec');
    ga('ec:addProduct', product);

    switch (action) {
      case 'select_content':
        ga('ec:setAction', 'detail');
        break;

      case 'add_to_cart':
        ga('ec:setAction', 'add');
        break;

      case 'begin_checkout':
        ga('ec:setAction', 'checkout', {
          step
        });
        break;

      default:
    }
  }
}

function wpAnalyticsTrackingSetup() {
  const version = wpAnalyticsCheckAnalyticsVersion();

  if ('' === version) {
    return;
  } // settings for ScrollDepth plugin


  if ('undefined' !== typeof analytics_scrolldepth_settings.scroll && true === analytics_scrolldepth_settings.scroll.enabled) {
    const scrollDepthSettings = []; // this needs to be true, regardless, because otherwise the assumption is that the tracking is defined in Google Tag Manager.
    // todo: it might be worth building a setting for this.

    scrollDepthSettings.gtmOverride = true; // if we're using ga, we need to tell the plugin

    if ('gtag' !== version) {
      scrollDepthSettings.gaGlobal = 'ga';
    } // value is a string


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.minimum_height && '0' !== analytics_scrolldepth_settings.scroll.minimum_height) {
      scrollDepthSettings.minimum_height = analytics_scrolldepth_settings.scroll.minimum_height;
    } // value is a boolean. default is true.


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.percentage && 'true' !== analytics_scrolldepth_settings.scroll.percentage) {
      scrollDepthSettings.percentage = false;
    } // value is a boolean. default is true.


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.user_timing && 'true' !== analytics_scrolldepth_settings.scroll.user_timing) {
      scrollDepthSettings.user_timing = false;
    } // value is a boolean. default is true.


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.pixel_depth && 'true' !== analytics_scrolldepth_settings.scroll.user_timing) {
      scrollDepthSettings.pixel_depth = false;
    } // value is a boolean. default is true.


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.non_interaction && 'true' !== analytics_scrolldepth_settings.scroll.non_interaction) {
      scrollDepthSettings.non_interaction = false;
    } // value is an array. default is empty.


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.scroll_elements) {
      scrollDepthSettings.elements = $.map(analytics_scrolldepth_settings.scroll.scroll_elements.split(','), $.trim);
    } // send scroll settings to the scrolldepth plugin


    if ('undefined' !== typeof analytics_scrolldepth_settings.scroll.use_jquery && true === analytics_scrolldepth_settings.scroll.use_jquery) {
      jQuery.scrollDepth(scrollDepthSettings);
    } else {
      gascrolldepth.init(scrollDepthSettings);
    }
  }

  if ('undefined' !== typeof analytics_tracking_settings.special && true === analytics_tracking_settings.special.enabled) {
    // external links
    $('a[href^="http"]:not([href*="://' + document.domain + '"])').click(function () {
      wpAnalyticsTrackingEvent('event', 'Outbound links', 'Click', this.href);
    }); // mailto links

    $('a[href^="mailto"]').click(function () {
      wpAnalyticsTrackingEvent('event', 'Mails', 'Click', this.href.substring(7));
    }); // tel links

    $('a[href^="tel"]').click(function () {
      wpAnalyticsTrackingEvent('event', 'Telephone', 'Call', this.href.substring(7));
    }); // internal links

    $('a:not([href^="(http:|https:)?//"],[href^="#"],[href^="mailto:"])').click(function () {
      // track downloads
      if ('' !== analytics_tracking_settings.special.download_regex) {
        const url = this.href;
        const checkDownload = new RegExp('\\.(' + analytics_tracking_settings.special.download_regex + ')([?#].*)?$', 'i');
        const isDownload = checkDownload.test(url);

        if (true === isDownload) {
          const checkDownloadExtension = new RegExp('\\.(' + analytics_tracking_settings.special.download_regex + ')([?#].*)?$', 'i');
          const extensionResult = checkDownloadExtension.exec(url);
          let extension = '';

          if (null !== extensionResult) {
            extension = extensionResult[1];
          } else {
            extension = extensionResult;
          } // we can't use the url for the value here, even though that would be nice, because value is supposed to be an integer


          wpAnalyticsTrackingEvent('event', 'Downloads', extension, this.href);
        }
      }
    });
  }

  if ('undefined' !== typeof analytics_tracking_settings.affiliate && true === analytics_tracking_settings.affiliate.enabled) {
    // any link could be an affiliate, i guess?
    $('a').click(function () {
      const url = this.href; // track affiliates

      if ('' !== analytics_tracking_settings.affiliate.affiliate_regex) {
        const checkAffiliate = new RegExp('\\.(' + analytics_tracking_settings.affiliate.affiliate_regex + ')([?#].*)?$', 'i');
        const isAffiliate = checkAffiliate.test(url);

        if (true === isAffiliate) {
          wpAnalyticsTrackingEvent('event', 'Affiliate', 'Click', this.href);
        }
      }
    });
  } // link fragments as pageviews
  // does not use the event tracking method; flags a pageview instead.


  if ('undefined' !== typeof analytics_tracking_settings.fragment && true === analytics_tracking_settings.fragment.enabled) {
    window.onhashchange = function () {
      const fragmentUrl = location.pathname + location.search + location.hash;

      if ('gtag' === version) {
        gtag('set', 'page_path', fragmentUrl);
        gtag('event', 'page_view');
      } else if ('ga' === version) {
        ga('send', 'pageview', fragmentUrl);
      }
    };
  } // when a button is clicked, attach it to the form's data


  $('input[type="submit"], button[type="submit"]').on('click', function () {
    const form = $(this).parents('form:first');
    $(form).data('button', this);
  }); // basic form submits. track submit instead of click because otherwise it's weird.

  if ('undefined' !== typeof analytics_tracking_settings.form_submissions && true === analytics_tracking_settings.form_submissions.enabled) {
    $('form').submit(function () {
      const button = $(this).data('button') || $('input[type="submit"], button[type="submit"]').get(0);
      const category = $(button).data('ga-category') || 'Form';
      const action = $(button).data('ga-action') || 'Submit';
      const label = $(button).data('ga-label') || $(button).text() || button.value || button.name;
      wpAnalyticsTrackingEvent('event', category, action, label);
    });
  }
}

$(document).ready(function () {
  wpAnalyticsTrackingSetup();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndwLWV2ZW50LXRyYWNraW5nLmpzIl0sIm5hbWVzIjpbIndwQW5hbHl0aWNzQ2hlY2tBbmFseXRpY3NWZXJzaW9uIiwidmVyc2lvbiIsImFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncyIsImFuYWx5dGljc190eXBlIiwiZ3RhZyIsImdhIiwid3AiLCJob29rcyIsImFkZEFjdGlvbiIsIndwQW5hbHl0aWNzVHJhY2tpbmdFdmVudCIsIndwQW5hbHl0aWNzVHJhY2tpbmdFY29tbWVyY2VBY3Rpb24iLCJ0eXBlIiwiY2F0ZWdvcnkiLCJhY3Rpb24iLCJsYWJlbCIsInZhbHVlIiwibm9uX2ludGVyYWN0aW9uIiwicGFyYW1zIiwiZXZlbnRfY2F0ZWdvcnkiLCJldmVudF9sYWJlbCIsIm5vbkludGVyYWN0aW9uIiwicHJvZHVjdCIsInN0ZXAiLCJpdGVtcyIsIndwQW5hbHl0aWNzVHJhY2tpbmdTZXR1cCIsImFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncyIsInNjcm9sbCIsImVuYWJsZWQiLCJzY3JvbGxEZXB0aFNldHRpbmdzIiwiZ3RtT3ZlcnJpZGUiLCJnYUdsb2JhbCIsIm1pbmltdW1faGVpZ2h0IiwicGVyY2VudGFnZSIsInVzZXJfdGltaW5nIiwicGl4ZWxfZGVwdGgiLCJzY3JvbGxfZWxlbWVudHMiLCJlbGVtZW50cyIsIiQiLCJtYXAiLCJzcGxpdCIsInRyaW0iLCJ1c2VfanF1ZXJ5IiwialF1ZXJ5Iiwic2Nyb2xsRGVwdGgiLCJnYXNjcm9sbGRlcHRoIiwiaW5pdCIsInNwZWNpYWwiLCJkb2N1bWVudCIsImRvbWFpbiIsImNsaWNrIiwiaHJlZiIsInN1YnN0cmluZyIsImRvd25sb2FkX3JlZ2V4IiwidXJsIiwiY2hlY2tEb3dubG9hZCIsIlJlZ0V4cCIsImlzRG93bmxvYWQiLCJ0ZXN0IiwiY2hlY2tEb3dubG9hZEV4dGVuc2lvbiIsImV4dGVuc2lvblJlc3VsdCIsImV4ZWMiLCJleHRlbnNpb24iLCJhZmZpbGlhdGUiLCJhZmZpbGlhdGVfcmVnZXgiLCJjaGVja0FmZmlsaWF0ZSIsImlzQWZmaWxpYXRlIiwiZnJhZ21lbnQiLCJ3aW5kb3ciLCJvbmhhc2hjaGFuZ2UiLCJmcmFnbWVudFVybCIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJzZWFyY2giLCJoYXNoIiwib24iLCJmb3JtIiwicGFyZW50cyIsImRhdGEiLCJmb3JtX3N1Ym1pc3Npb25zIiwic3VibWl0IiwiYnV0dG9uIiwiZ2V0IiwidGV4dCIsIm5hbWUiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxTQUFTQSxnQ0FBVCxHQUE0QztFQUMzQyxJQUFJQyxPQUFPLEdBQUcsRUFBZDs7RUFDQSxJQUNDLGdCQUFnQixPQUFPQywyQkFBdkIsSUFDQSxnQkFBZ0IsT0FBT0EsMkJBQTJCLENBQUNDLGNBRnBELEVBR0U7SUFDRCxJQUNDLGFBQWFELDJCQUEyQixDQUFDQyxjQUF6QyxJQUNBLGVBQWUsT0FBT0MsSUFGdkIsRUFHRTtNQUNESCxPQUFPLEdBQUcsTUFBVjtJQUNBLENBTEQsTUFLTyxJQUNOLGtCQUFrQkMsMkJBQTJCLENBQUNDLGNBQTlDLElBQ0EsZUFBZSxPQUFPRSxFQUZoQixFQUdMO01BQ0RKLE9BQU8sR0FBRyxJQUFWO0lBQ0E7RUFDRDs7RUFDRCxPQUFPQSxPQUFQO0FBQ0E7QUFFRDtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0EsSUFBSSxPQUFPSyxFQUFQLEtBQWMsV0FBbEIsRUFBK0I7RUFDOUJBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTQyxTQUFULENBQ0MsbUNBREQsRUFFQyw4QkFGRCxFQUdDQyx3QkFIRCxFQUlDLEVBSkQ7RUFNQUgsRUFBRSxDQUFDQyxLQUFILENBQVNDLFNBQVQsQ0FDQyw2Q0FERCxFQUVDLDhCQUZELEVBR0NFLGtDQUhELEVBSUMsRUFKRDtBQU1BO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNELHdCQUFULENBQ0NFLElBREQsRUFFQ0MsUUFGRCxFQUdDQyxNQUhELEVBSUNDLEtBSkQsRUFLQ0MsS0FMRCxFQU1D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VSxRQUFELENBQUQsQ0FBWXFDLEtBQVosQ0FBa0IsWUFBWTtFQUM3QjVELHdCQUF3QjtBQUN4QixDQUZEIiwiZmlsZSI6IndwLWFuYWx5dGljcy10cmFja2luZy1nZW5lcmF0b3ItZnJvbnQtZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gd3BBbmFseXRpY3NDaGVja0FuYWx5dGljc1ZlcnNpb24oKSB7XG5cdGxldCB2ZXJzaW9uID0gJyc7XG5cdGlmIChcblx0XHQndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncyAmJlxuXHRcdCd1bmRlZmluZWQnICE9PSB0eXBlb2YgYW5hbHl0aWNzX3RyYWNraW5nX3NldHRpbmdzLmFuYWx5dGljc190eXBlXG5cdCkge1xuXHRcdGlmIChcblx0XHRcdCdndGFnanMnID09PSBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuYW5hbHl0aWNzX3R5cGUgJiZcblx0XHRcdCdmdW5jdGlvbicgPT09IHR5cGVvZiBndGFnXG5cdFx0KSB7XG5cdFx0XHR2ZXJzaW9uID0gJ2d0YWcnO1xuXHRcdH0gZWxzZSBpZiAoXG5cdFx0XHQnYW5hbHl0aWNzanMnID09PSBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuYW5hbHl0aWNzX3R5cGUgJiZcblx0XHRcdCdmdW5jdGlvbicgPT09IHR5cGVvZiBnYVxuXHRcdCkge1xuXHRcdFx0dmVyc2lvbiA9ICdnYSc7XG5cdFx0fVxuXHR9XG5cdHJldHVybiB2ZXJzaW9uO1xufVxuXG4vKlxuICogY2FsbCBob29rcyBmcm9tIG90aGVyIHBsdWdpbnMgb3IgdGhlbWVzXG4gKlxuICovXG5pZiAodHlwZW9mIHdwICE9PSAndW5kZWZpbmVkJykge1xuXHR3cC5ob29rcy5hZGRBY3Rpb24oXG5cdFx0J3dwQW5hbHl0aWNzVHJhY2tpbmdHZW5lcmF0b3JFdmVudCcsXG5cdFx0J3dwQW5hbHl0aWNzVHJhY2tpbmdHZW5lcmF0b3InLFxuXHRcdHdwQW5hbHl0aWNzVHJhY2tpbmdFdmVudCxcblx0XHQxMFxuXHQpO1xuXHR3cC5ob29rcy5hZGRBY3Rpb24oXG5cdFx0J3dwQW5hbHl0aWNzVHJhY2tpbmdHZW5lcmF0b3JFY29tbWVyY2VBY3Rpb24nLFxuXHRcdCd3cEFuYWx5dGljc1RyYWNraW5nR2VuZXJhdG9yJyxcblx0XHR3cEFuYWx5dGljc1RyYWNraW5nRWNvbW1lcmNlQWN0aW9uLFxuXHRcdDEwXG5cdCk7XG59XG5cbi8qXG4gKiBDcmVhdGUgYSBHb29nbGUgQW5hbHl0aWNzIGV2ZW50XG4gKiBjYXRlZ29yeTogRXZlbnQgQ2F0ZWdvcnlcbiAqIGxhYmVsOiBFdmVudCBMYWJlbFxuICogYWN0aW9uOiBFdmVudCBBY3Rpb25cbiAqIHZhbHVlOiBvcHRpb25hbFxuICovXG5mdW5jdGlvbiB3cEFuYWx5dGljc1RyYWNraW5nRXZlbnQoXG5cdHR5cGUsXG5cdGNhdGVnb3J5LFxuXHRhY3Rpb24sXG5cdGxhYmVsLFxuXHR2YWx1ZSxcblx0bm9uX2ludGVyYWN0aW9uXG4pIHtcblx0Y29uc3QgdmVyc2lvbiA9IHdwQW5hbHl0aWNzQ2hlY2tBbmFseXRpY3NWZXJzaW9uKCk7XG5cdGlmICgnZ3RhZycgPT09IHZlcnNpb24pIHtcblx0XHQvLyBTZW5kcyB0aGUgZXZlbnQgdG8gdGhlIEdvb2dsZSBBbmFseXRpY3MgcHJvcGVydHkgd2l0aFxuXHRcdC8vIHRyYWNraW5nIElEIEdBX01FQVNVUkVNRU5UX0lEIHNldCBieSB0aGUgY29uZmlnIGNvbW1hbmQgaW5cblx0XHQvLyB0aGUgZ2xvYmFsIHRyYWNraW5nIHNuaXBwZXQuXG5cdFx0Ly8gZXhhbXBsZTogZ3RhZygnZXZlbnQnLCAncGxheScsIHsgJ2V2ZW50X2NhdGVnb3J5JzogJ1ZpZGVvcycsICdldmVudF9sYWJlbCc6ICdGYWxsIENhbXBhaWduJyB9KTtcblx0XHRjb25zdCBwYXJhbXMgPSB7XG5cdFx0XHRldmVudF9jYXRlZ29yeTogY2F0ZWdvcnksXG5cdFx0XHRldmVudF9sYWJlbDogbGFiZWwsXG5cdFx0fTtcblx0XHRpZiAoJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB2YWx1ZSkge1xuXHRcdFx0cGFyYW1zLnZhbHVlID0gdmFsdWU7XG5cdFx0fVxuXHRcdGlmICgndW5kZWZpbmVkJyAhPT0gdHlwZW9mIG5vbl9pbnRlcmFjdGlvbikge1xuXHRcdFx0cGFyYW1zLm5vbl9pbnRlcmFjdGlvbiA9IG5vbl9pbnRlcmFjdGlvbjtcblx0XHR9XG5cdFx0Z3RhZyh0eXBlLCBhY3Rpb24sIHBhcmFtcyk7XG5cdH0gZWxzZSBpZiAoJ2dhJyA9PT0gdmVyc2lvbikge1xuXHRcdC8vIFVzZXMgdGhlIGRlZmF1bHQgdHJhY2tlciB0byBzZW5kIHRoZSBldmVudCB0byB0aGVcblx0XHQvLyBHb29nbGUgQW5hbHl0aWNzIHByb3BlcnR5IHdpdGggdHJhY2tpbmcgSUQgR0FfTUVBU1VSRU1FTlRfSUQuXG5cdFx0Ly8gZXhhbXBsZTogZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnVmlkZW9zJywgJ3BsYXknLCAnRmFsbCBDYW1wYWlnbicpO1xuXHRcdC8vIG5vbmludGVyYWN0aW9uIHNlZW1zIHRvIGhhdmUgYmVlbiB3b3JraW5nIGxpa2UgdGhpcyBpbiBhbmFseXRpY3MuanMuXG5cdFx0aWYgKG5vbl9pbnRlcmFjdGlvbiA9PT0gMSkge1xuXHRcdFx0dmFsdWUgPSB7IG5vbkludGVyYWN0aW9uOiAxIH07XG5cdFx0fVxuXHRcdGlmICgndW5kZWZpbmVkJyA9PT0gdHlwZW9mIHZhbHVlKSB7XG5cdFx0XHRnYSgnc2VuZCcsIHR5cGUsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Z2EoJ3NlbmQnLCB0eXBlLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCwgdmFsdWUpO1xuXHRcdH1cblx0fVxufVxuXG4vKlxuICogQ3JlYXRlIGEgR29vZ2xlIEFuYWx5dGljcyBFY29tbWVyY2UgYWN0aW9uXG4gKlxuICovXG5mdW5jdGlvbiB3cEFuYWx5dGljc1RyYWNraW5nRWNvbW1lcmNlQWN0aW9uKHR5cGUsIGFjdGlvbiwgcHJvZHVjdCwgc3RlcCkge1xuXHRjb25zdCB2ZXJzaW9uID0gd3BBbmFseXRpY3NDaGVja0FuYWx5dGljc1ZlcnNpb24oKTtcblx0aWYgKCdndGFnJyA9PT0gdmVyc2lvbikge1xuXHRcdGd0YWcodHlwZSwgYWN0aW9uLCB7XG5cdFx0XHRpdGVtczogW3Byb2R1Y3RdLFxuXHRcdH0pO1xuXHR9IGVsc2UgaWYgKCdnYScgPT09IHZlcnNpb24pIHtcblx0XHRnYSgncmVxdWlyZScsICdlYycpO1xuXHRcdGdhKCdlYzphZGRQcm9kdWN0JywgcHJvZHVjdCk7XG5cdFx0c3dpdGNoIChhY3Rpb24pIHtcblx0XHRcdGNhc2UgJ3NlbGVjdF9jb250ZW50Jzpcblx0XHRcdFx0Z2EoJ2VjOnNldEFjdGlvbicsICdkZXRhaWwnKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdhZGRfdG9fY2FydCc6XG5cdFx0XHRcdGdhKCdlYzpzZXRBY3Rpb24nLCAnYWRkJyk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnYmVnaW5fY2hlY2tvdXQnOlxuXHRcdFx0XHRnYSgnZWM6c2V0QWN0aW9uJywgJ2NoZWNrb3V0Jywge1xuXHRcdFx0XHRcdHN0ZXAsXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIHdwQW5hbHl0aWNzVHJhY2tpbmdTZXR1cCgpIHtcblx0Y29uc3QgdmVyc2lvbiA9IHdwQW5hbHl0aWNzQ2hlY2tBbmFseXRpY3NWZXJzaW9uKCk7XG5cdGlmICgnJyA9PT0gdmVyc2lvbikge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdC8vIHNldHRpbmdzIGZvciBTY3JvbGxEZXB0aCBwbHVnaW5cblx0aWYgKFxuXHRcdCd1bmRlZmluZWQnICE9PSB0eXBlb2YgYW5hbHl0aWNzX3Njcm9sbGRlcHRoX3NldHRpbmdzLnNjcm9sbCAmJlxuXHRcdHRydWUgPT09IGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwuZW5hYmxlZFxuXHQpIHtcblx0XHRjb25zdCBzY3JvbGxEZXB0aFNldHRpbmdzID0gW107XG5cdFx0Ly8gdGhpcyBuZWVkcyB0byBiZSB0cnVlLCByZWdhcmRsZXNzLCBiZWNhdXNlIG90aGVyd2lzZSB0aGUgYXNzdW1wdGlvbiBpcyB0aGF0IHRoZSB0cmFja2luZyBpcyBkZWZpbmVkIGluIEdvb2dsZSBUYWcgTWFuYWdlci5cblx0XHQvLyB0b2RvOiBpdCBtaWdodCBiZSB3b3J0aCBidWlsZGluZyBhIHNldHRpbmcgZm9yIHRoaXMuXG5cdFx0c2Nyb2xsRGVwdGhTZXR0aW5ncy5ndG1PdmVycmlkZSA9IHRydWU7XG5cblx0XHQvLyBpZiB3ZSdyZSB1c2luZyBnYSwgd2UgbmVlZCB0byB0ZWxsIHRoZSBwbHVnaW5cblx0XHRpZiAoJ2d0YWcnICE9PSB2ZXJzaW9uKSB7XG5cdFx0XHRzY3JvbGxEZXB0aFNldHRpbmdzLmdhR2xvYmFsID0gJ2dhJztcblx0XHR9XG5cblx0XHQvLyB2YWx1ZSBpcyBhIHN0cmluZ1xuXHRcdGlmIChcblx0XHRcdCd1bmRlZmluZWQnICE9PVxuXHRcdFx0XHR0eXBlb2YgYW5hbHl0aWNzX3Njcm9sbGRlcHRoX3NldHRpbmdzLnNjcm9sbC5taW5pbXVtX2hlaWdodCAmJlxuXHRcdFx0JzAnICE9PSBhbmFseXRpY3Nfc2Nyb2xsZGVwdGhfc2V0dGluZ3Muc2Nyb2xsLm1pbmltdW1faGVpZ2h0XG5cdFx0KSB7XG5cdFx0XHRzY3JvbGxEZXB0aFNldHRpbmdzLm1pbmltdW1faGVpZ2h0ID1cblx0XHRcdFx0YW5hbHl0aWNzX3Njcm9sbGRlcHRoX3NldHRpbmdzLnNjcm9sbC5taW5pbXVtX2hlaWdodDtcblx0XHR9XG5cblx0XHQvLyB2YWx1ZSBpcyBhIGJvb2xlYW4uIGRlZmF1bHQgaXMgdHJ1ZS5cblx0XHRpZiAoXG5cdFx0XHQndW5kZWZpbmVkJyAhPT1cblx0XHRcdFx0dHlwZW9mIGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwucGVyY2VudGFnZSAmJlxuXHRcdFx0J3RydWUnICE9PSBhbmFseXRpY3Nfc2Nyb2xsZGVwdGhfc2V0dGluZ3Muc2Nyb2xsLnBlcmNlbnRhZ2Vcblx0XHQpIHtcblx0XHRcdHNjcm9sbERlcHRoU2V0dGluZ3MucGVyY2VudGFnZSA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIHZhbHVlIGlzIGEgYm9vbGVhbi4gZGVmYXVsdCBpcyB0cnVlLlxuXHRcdGlmIChcblx0XHRcdCd1bmRlZmluZWQnICE9PVxuXHRcdFx0XHR0eXBlb2YgYW5hbHl0aWNzX3Njcm9sbGRlcHRoX3NldHRpbmdzLnNjcm9sbC51c2VyX3RpbWluZyAmJlxuXHRcdFx0J3RydWUnICE9PSBhbmFseXRpY3Nfc2Nyb2xsZGVwdGhfc2V0dGluZ3Muc2Nyb2xsLnVzZXJfdGltaW5nXG5cdFx0KSB7XG5cdFx0XHRzY3JvbGxEZXB0aFNldHRpbmdzLnVzZXJfdGltaW5nID0gZmFsc2U7XG5cdFx0fVxuXG5cdFx0Ly8gdmFsdWUgaXMgYSBib29sZWFuLiBkZWZhdWx0IGlzIHRydWUuXG5cdFx0aWYgKFxuXHRcdFx0J3VuZGVmaW5lZCcgIT09XG5cdFx0XHRcdHR5cGVvZiBhbmFseXRpY3Nfc2Nyb2xsZGVwdGhfc2V0dGluZ3Muc2Nyb2xsLnBpeGVsX2RlcHRoICYmXG5cdFx0XHQndHJ1ZScgIT09IGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwudXNlcl90aW1pbmdcblx0XHQpIHtcblx0XHRcdHNjcm9sbERlcHRoU2V0dGluZ3MucGl4ZWxfZGVwdGggPSBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyB2YWx1ZSBpcyBhIGJvb2xlYW4uIGRlZmF1bHQgaXMgdHJ1ZS5cblx0XHRpZiAoXG5cdFx0XHQndW5kZWZpbmVkJyAhPT1cblx0XHRcdFx0dHlwZW9mIGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwubm9uX2ludGVyYWN0aW9uICYmXG5cdFx0XHQndHJ1ZScgIT09IGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwubm9uX2ludGVyYWN0aW9uXG5cdFx0KSB7XG5cdFx0XHRzY3JvbGxEZXB0aFNldHRpbmdzLm5vbl9pbnRlcmFjdGlvbiA9IGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIHZhbHVlIGlzIGFuIGFycmF5LiBkZWZhdWx0IGlzIGVtcHR5LlxuXHRcdGlmIChcblx0XHRcdCd1bmRlZmluZWQnICE9PVxuXHRcdFx0dHlwZW9mIGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwuc2Nyb2xsX2VsZW1lbnRzXG5cdFx0KSB7XG5cdFx0XHRzY3JvbGxEZXB0aFNldHRpbmdzLmVsZW1lbnRzID0gJC5tYXAoXG5cdFx0XHRcdGFuYWx5dGljc19zY3JvbGxkZXB0aF9zZXR0aW5ncy5zY3JvbGwuc2Nyb2xsX2VsZW1lbnRzLnNwbGl0KFxuXHRcdFx0XHRcdCcsJ1xuXHRcdFx0XHQpLFxuXHRcdFx0XHQkLnRyaW1cblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Ly8gc2VuZCBzY3JvbGwgc2V0dGluZ3MgdG8gdGhlIHNjcm9sbGRlcHRoIHBsdWdpblxuXHRcdGlmIChcblx0XHRcdCd1bmRlZmluZWQnICE9PVxuXHRcdFx0XHR0eXBlb2YgYW5hbHl0aWNzX3Njcm9sbGRlcHRoX3NldHRpbmdzLnNjcm9sbC51c2VfanF1ZXJ5ICYmXG5cdFx0XHR0cnVlID09PSBhbmFseXRpY3Nfc2Nyb2xsZGVwdGhfc2V0dGluZ3Muc2Nyb2xsLnVzZV9qcXVlcnlcblx0XHQpIHtcblx0XHRcdGpRdWVyeS5zY3JvbGxEZXB0aChzY3JvbGxEZXB0aFNldHRpbmdzKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Z2FzY3JvbGxkZXB0aC5pbml0KHNjcm9sbERlcHRoU2V0dGluZ3MpO1xuXHRcdH1cblx0fVxuXG5cdGlmIChcblx0XHQndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncy5zcGVjaWFsICYmXG5cdFx0dHJ1ZSA9PT0gYW5hbHl0aWNzX3RyYWNraW5nX3NldHRpbmdzLnNwZWNpYWwuZW5hYmxlZFxuXHQpIHtcblx0XHQvLyBleHRlcm5hbCBsaW5rc1xuXHRcdCQoJ2FbaHJlZl49XCJodHRwXCJdOm5vdChbaHJlZio9XCI6Ly8nICsgZG9jdW1lbnQuZG9tYWluICsgJ1wiXSknKS5jbGljayhcblx0XHRcdGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0d3BBbmFseXRpY3NUcmFja2luZ0V2ZW50KFxuXHRcdFx0XHRcdCdldmVudCcsXG5cdFx0XHRcdFx0J091dGJvdW5kIGxpbmtzJyxcblx0XHRcdFx0XHQnQ2xpY2snLFxuXHRcdFx0XHRcdHRoaXMuaHJlZlxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdCk7XG5cblx0XHQvLyBtYWlsdG8gbGlua3Ncblx0XHQkKCdhW2hyZWZePVwibWFpbHRvXCJdJykuY2xpY2soZnVuY3Rpb24gKCkge1xuXHRcdFx0d3BBbmFseXRpY3NUcmFja2luZ0V2ZW50KFxuXHRcdFx0XHQnZXZlbnQnLFxuXHRcdFx0XHQnTWFpbHMnLFxuXHRcdFx0XHQnQ2xpY2snLFxuXHRcdFx0XHR0aGlzLmhyZWYuc3Vic3RyaW5nKDcpXG5cdFx0XHQpO1xuXHRcdH0pO1xuXG5cdFx0Ly8gdGVsIGxpbmtzXG5cdFx0JCgnYVtocmVmXj1cInRlbFwiXScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcblx0XHRcdHdwQW5hbHl0aWNzVHJhY2tpbmdFdmVudChcblx0XHRcdFx0J2V2ZW50Jyxcblx0XHRcdFx0J1RlbGVwaG9uZScsXG5cdFx0XHRcdCdDYWxsJyxcblx0XHRcdFx0dGhpcy5ocmVmLnN1YnN0cmluZyg3KVxuXHRcdFx0KTtcblx0XHR9KTtcblxuXHRcdC8vIGludGVybmFsIGxpbmtzXG5cdFx0JChcblx0XHRcdCdhOm5vdChbaHJlZl49XCIoaHR0cDp8aHR0cHM6KT8vL1wiXSxbaHJlZl49XCIjXCJdLFtocmVmXj1cIm1haWx0bzpcIl0pJ1xuXHRcdCkuY2xpY2soZnVuY3Rpb24gKCkge1xuXHRcdFx0Ly8gdHJhY2sgZG93bmxvYWRzXG5cdFx0XHRpZiAoJycgIT09IGFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncy5zcGVjaWFsLmRvd25sb2FkX3JlZ2V4KSB7XG5cdFx0XHRcdGNvbnN0IHVybCA9IHRoaXMuaHJlZjtcblx0XHRcdFx0Y29uc3QgY2hlY2tEb3dubG9hZCA9IG5ldyBSZWdFeHAoXG5cdFx0XHRcdFx0J1xcXFwuKCcgK1xuXHRcdFx0XHRcdFx0YW5hbHl0aWNzX3RyYWNraW5nX3NldHRpbmdzLnNwZWNpYWwuZG93bmxvYWRfcmVnZXggK1xuXHRcdFx0XHRcdFx0JykoWz8jXS4qKT8kJyxcblx0XHRcdFx0XHQnaSdcblx0XHRcdFx0KTtcblx0XHRcdFx0Y29uc3QgaXNEb3dubG9hZCA9IGNoZWNrRG93bmxvYWQudGVzdCh1cmwpO1xuXHRcdFx0XHRpZiAodHJ1ZSA9PT0gaXNEb3dubG9hZCkge1xuXHRcdFx0XHRcdGNvbnN0IGNoZWNrRG93bmxvYWRFeHRlbnNpb24gPSBuZXcgUmVnRXhwKFxuXHRcdFx0XHRcdFx0J1xcXFwuKCcgK1xuXHRcdFx0XHRcdFx0XHRhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3Muc3BlY2lhbC5kb3dubG9hZF9yZWdleCArXG5cdFx0XHRcdFx0XHRcdCcpKFs/I10uKik/JCcsXG5cdFx0XHRcdFx0XHQnaSdcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdGNvbnN0IGV4dGVuc2lvblJlc3VsdCA9IGNoZWNrRG93bmxvYWRFeHRlbnNpb24uZXhlYyh1cmwpO1xuXHRcdFx0XHRcdGxldCBleHRlbnNpb24gPSAnJztcblx0XHRcdFx0XHRpZiAobnVsbCAhPT0gZXh0ZW5zaW9uUmVzdWx0KSB7XG5cdFx0XHRcdFx0XHRleHRlbnNpb24gPSBleHRlbnNpb25SZXN1bHRbMV07XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGV4dGVuc2lvbiA9IGV4dGVuc2lvblJlc3VsdDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gd2UgY2FuJ3QgdXNlIHRoZSB1cmwgZm9yIHRoZSB2YWx1ZSBoZXJlLCBldmVuIHRob3VnaCB0aGF0IHdvdWxkIGJlIG5pY2UsIGJlY2F1c2UgdmFsdWUgaXMgc3VwcG9zZWQgdG8gYmUgYW4gaW50ZWdlclxuXHRcdFx0XHRcdHdwQW5hbHl0aWNzVHJhY2tpbmdFdmVudChcblx0XHRcdFx0XHRcdCdldmVudCcsXG5cdFx0XHRcdFx0XHQnRG93bmxvYWRzJyxcblx0XHRcdFx0XHRcdGV4dGVuc2lvbixcblx0XHRcdFx0XHRcdHRoaXMuaHJlZlxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdGlmIChcblx0XHQndW5kZWZpbmVkJyAhPT0gdHlwZW9mIGFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncy5hZmZpbGlhdGUgJiZcblx0XHR0cnVlID09PSBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuYWZmaWxpYXRlLmVuYWJsZWRcblx0KSB7XG5cdFx0Ly8gYW55IGxpbmsgY291bGQgYmUgYW4gYWZmaWxpYXRlLCBpIGd1ZXNzP1xuXHRcdCQoJ2EnKS5jbGljayhmdW5jdGlvbiAoKSB7XG5cdFx0XHRjb25zdCB1cmwgPSB0aGlzLmhyZWY7XG5cdFx0XHQvLyB0cmFjayBhZmZpbGlhdGVzXG5cdFx0XHRpZiAoJycgIT09IGFuYWx5dGljc190cmFja2luZ19zZXR0aW5ncy5hZmZpbGlhdGUuYWZmaWxpYXRlX3JlZ2V4KSB7XG5cdFx0XHRcdGNvbnN0IGNoZWNrQWZmaWxpYXRlID0gbmV3IFJlZ0V4cChcblx0XHRcdFx0XHQnXFxcXC4oJyArXG5cdFx0XHRcdFx0XHRhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuYWZmaWxpYXRlLmFmZmlsaWF0ZV9yZWdleCArXG5cdFx0XHRcdFx0XHQnKShbPyNdLiopPyQnLFxuXHRcdFx0XHRcdCdpJ1xuXHRcdFx0XHQpO1xuXHRcdFx0XHRjb25zdCBpc0FmZmlsaWF0ZSA9IGNoZWNrQWZmaWxpYXRlLnRlc3QodXJsKTtcblx0XHRcdFx0aWYgKHRydWUgPT09IGlzQWZmaWxpYXRlKSB7XG5cdFx0XHRcdFx0d3BBbmFseXRpY3NUcmFja2luZ0V2ZW50KFxuXHRcdFx0XHRcdFx0J2V2ZW50Jyxcblx0XHRcdFx0XHRcdCdBZmZpbGlhdGUnLFxuXHRcdFx0XHRcdFx0J0NsaWNrJyxcblx0XHRcdFx0XHRcdHRoaXMuaHJlZlxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8vIGxpbmsgZnJhZ21lbnRzIGFzIHBhZ2V2aWV3c1xuXHQvLyBkb2VzIG5vdCB1c2UgdGhlIGV2ZW50IHRyYWNraW5nIG1ldGhvZDsgZmxhZ3MgYSBwYWdldmlldyBpbnN0ZWFkLlxuXHRpZiAoXG5cdFx0J3VuZGVmaW5lZCcgIT09IHR5cGVvZiBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuZnJhZ21lbnQgJiZcblx0XHR0cnVlID09PSBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuZnJhZ21lbnQuZW5hYmxlZFxuXHQpIHtcblx0XHR3aW5kb3cub25oYXNoY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc3QgZnJhZ21lbnRVcmwgPVxuXHRcdFx0XHRsb2NhdGlvbi5wYXRobmFtZSArIGxvY2F0aW9uLnNlYXJjaCArIGxvY2F0aW9uLmhhc2g7XG5cdFx0XHRpZiAoJ2d0YWcnID09PSB2ZXJzaW9uKSB7XG5cdFx0XHRcdGd0YWcoJ3NldCcsICdwYWdlX3BhdGgnLCBmcmFnbWVudFVybCk7XG5cdFx0XHRcdGd0YWcoJ2V2ZW50JywgJ3BhZ2VfdmlldycpO1xuXHRcdFx0fSBlbHNlIGlmICgnZ2EnID09PSB2ZXJzaW9uKSB7XG5cdFx0XHRcdGdhKCdzZW5kJywgJ3BhZ2V2aWV3JywgZnJhZ21lbnRVcmwpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1cblxuXHQvLyB3aGVuIGEgYnV0dG9uIGlzIGNsaWNrZWQsIGF0dGFjaCBpdCB0byB0aGUgZm9ybSdzIGRhdGFcblx0JCgnaW5wdXRbdHlwZT1cInN1Ym1pdFwiXSwgYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cdFx0Y29uc3QgZm9ybSA9ICQodGhpcykucGFyZW50cygnZm9ybTpmaXJzdCcpO1xuXHRcdCQoZm9ybSkuZGF0YSgnYnV0dG9uJywgdGhpcyk7XG5cdH0pO1xuXG5cdC8vIGJhc2ljIGZvcm0gc3VibWl0cy4gdHJhY2sgc3VibWl0IGluc3RlYWQgb2YgY2xpY2sgYmVjYXVzZSBvdGhlcndpc2UgaXQncyB3ZWlyZC5cblx0aWYgKFxuXHRcdCd1bmRlZmluZWQnICE9PSB0eXBlb2YgYW5hbHl0aWNzX3RyYWNraW5nX3NldHRpbmdzLmZvcm1fc3VibWlzc2lvbnMgJiZcblx0XHR0cnVlID09PSBhbmFseXRpY3NfdHJhY2tpbmdfc2V0dGluZ3MuZm9ybV9zdWJtaXNzaW9ucy5lbmFibGVkXG5cdCkge1xuXHRcdCQoJ2Zvcm0nKS5zdWJtaXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0Y29uc3QgYnV0dG9uID1cblx0XHRcdFx0JCh0aGlzKS5kYXRhKCdidXR0b24nKSB8fFxuXHRcdFx0XHQkKCdpbnB1dFt0eXBlPVwic3VibWl0XCJdLCBidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLmdldCgwKTtcblx0XHRcdGNvbnN0IGNhdGVnb3J5ID0gJChidXR0b24pLmRhdGEoJ2dhLWNhdGVnb3J5JykgfHwgJ0Zvcm0nO1xuXHRcdFx0Y29uc3QgYWN0aW9uID0gJChidXR0b24pLmRhdGEoJ2dhLWFjdGlvbicpIHx8ICdTdWJtaXQnO1xuXHRcdFx0Y29uc3QgbGFiZWwgPVxuXHRcdFx0XHQkKGJ1dHRvbikuZGF0YSgnZ2EtbGFiZWwnKSB8fFxuXHRcdFx0XHQkKGJ1dHRvbikudGV4dCgpIHx8XG5cdFx0XHRcdGJ1dHRvbi52YWx1ZSB8fFxuXHRcdFx0XHRidXR0b24ubmFtZTtcblx0XHRcdHdwQW5hbHl0aWNzVHJhY2tpbmdFdmVudCgnZXZlbnQnLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCk7XG5cdFx0fSk7XG5cdH1cbn1cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuXHR3cEFuYWx5dGljc1RyYWNraW5nU2V0dXAoKTtcbn0pO1xuIl19
}(jQuery));
